<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>tabbar</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../common/tabbar/css/index.css">

		<script src="../libs/seajs/app_3.0/sea.js"></script>
		<script src="../libs/mui/js/mui.min.js"></script>
		<script src="../libs/jquery/3.0.0/jquery-3.0.0.js"></script>
		<script>

			mui.init({
				swipeBack:false
			});
			mui.back= function(){
				
			}
			var CONFIG = {
				'static_path' : '../'
			};
			seajs.use(["../kit/util/urlToJson","../kit/util/plus-storage"],function($urlToJson,$storage){
			"use strict";

				var sys = {
					a_click: function(event) {
						var url = this.getAttribute('href');
						var d = $urlToJson(url);
						var data = sys.getLocalPath(d.url);
						if (!data) {
							return;
						}
						// $('a').removeClass('current');
						// $(this).addClass('current');
						var pageData = {
							id: data.module_id,
							url: '_www/modules/index_content.html',
							extras: {
								ajax_data: d.data,
								ajax_url: plus.storage.getItem("domain") + d.url,
								pageData: data.module_data
							},
							styles: {
								top: '45px',
								bottom: 0,
								bounce: 'vertical',
								background:'transparent'
							},
							title: data.title || $(this).html()

						}
						var view_data = {
							id: data.module_id,
							url: '_www/modules/index.html',
							show: {
								autoShow: true, //页面loaded事件发生后自动显示，默认为true
								aniShow: 'slide-in-right', //页面显示动画，默认为”slide-in-right“；
							},
		                    // styles: {
		                    //     top: "0px",
		                    //     bottom: '56px', //新页面底部位置
		                    // },
							extras: {
								pageData: pageData
							}
						};

						//数据重载来规避多页面打开的事儿
						if (data.module_id == "st_modules_h5_home") {
							mui.openWindow({
								id: 'index.html',
								url: '_www/modules/h5/index/index.html',
			                    // styles: {
			                    //     top: "0px",
			                    //     bottom: '56px', //新页面底部位置
			                    // },
								show: {
									autoShow: true, //页面loaded事件发生后自动显示，默认为true
									aniShow: 'slide-in-right', //页面显示动画，默认为”slide-in-right“；
								}
							});
							return;
						}
						var other_this_view = plus.webview.getWebviewById(data.module_id.replace('st_modules_', ''));
						if (other_this_view && (!$.isEmptyObject(d.data))) {
							mui.fire(other_this_view, 'viewReload', {
								ajax_data: d.data
							}); //数据重载方法,可多页面调用
						}
						mui.openWindow(view_data);
						return false;
					},
					getLocalPath: function(path) {
						var a = sys.route;
						if(!a){
							return;
						}
						var data;
						for (var i = 0; i < a.length; i++) {
							if ($.trim(a[i].path) == $.trim(path)) {
								data = a[i].data.default_data.modules[0];
								return {
									path: data.template[0].replace('template/index.html', '') + data.id.replace('st_modules_h5_', '') + '.html',
									module_id: data.id,
									title: data.title,
									module_data: data
								};
							}
						}
						return null;
					},
					listener: function() {
						window.addEventListener('reactive', function(e) {
							$(window).scrollTop(0);
							$('#' + sys.id).html('<div class="fakeloader"><div class="fl spinner1"><div class="double-bounce1"></div><div class="double-bounce2"></div></div><div class="text">数据加载中...</div></div>');
							// sys.ajax_data = e.detail.ajax_data;
							// sys.storage_init();
						});
					},
					init: function() {

						mui.plusReady(function() {
							plus.webview.currentWebview().setStyle({popGesture:'none'});	//禁止侧滑关闭
			            	sys.route = $storage('route');
							sys.listener();
							mui('body').on('tap', 'a', sys.a_click)

							return sys;
						})
					}
				}
				sys.init();
			});
		</script>
	</head>

	<body>
		<nav class="border-1px tabbar">
			<a onclick="return false" href="" pjax="1" class="tabbar-item current" data-index="0">
				<span class="tabbar-icon icon-home"></span>
				<span class="tabbar-text">首页</span>
			</a>
			<a onclick="return false" href="/castle/wap/course/course-list" pjax="1" class="tabbar-item" data-index="1">
				<span class="tabbar-icon icon-lesson"></span>
				<span class="tabbar-text">课程</span>
			</a>
			<a onclick="return false" href="/castle/wap/exam/list" pjax="1" class="tabbar-item" data-index="2">
				<span class="tabbar-icon icon-test"></span>
				<span class="tabbar-text">评测</span>
			</a>
			<a onclick="return false" href="/castle/wap/user/show" pjax="1" class="tabbar-item" data-index="3">
				<span class="tabbar-icon icon-me"></span>
				<span class="tabbar-text">我</span>
			</a>
		</nav>
		<div class="tabbar-block"></div>
	</body>

</html>